<!-- HTML Document with Portuguese-Brazil language -->
<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Meta tags for character set and language -->
    <meta charset="utf-8">
    <meta http-equiv="Content-Language" content="pt-br">

    <!-- Page title -->
    <title>Galeria Bernardino</title>

    <!-- Meta tags for responsive design -->
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

    <!-- Favicon -->
    <link href="img/favicon.ico" rel="icon">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Roboto:wght@500;700&display=swap" rel="stylesheet">

    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />
    <link href='https://unpkg.com/boxicons@2.1.1/css/boxicons.min.css' rel='stylesheet'>

    <!-- Customized Bootstrap Stylesheet -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="css/style.css" rel="stylesheet">
</head>

<!-- Body with an onload event to trigger the function "listarClientes()" -->
<body onload="listarClientes()">
    <!-- Div with the id "tela" and inline style to initially set display as none -->
    <div id="tela" style="display: none;">

        <!-- Container for the entire content with classes for position and flex layout -->
        <div class="container-fluid position-relative d-flex p-0">

            <!-- Spinner Start -->
            <!-- Div for displaying a spinner during loading with classes for styling and positioning -->
            <div id="spinner" class="show bg-dark position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
                <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
                    <span class="sr-only">Loading...</span>
                </div>
            </div>
            <!-- Spinner End -->

            <!-- Sidebar Start -->
            <!-- Div for the sidebar with classes for styling and padding -->
            <div class="sidebar pe-4 pb-3">
                <!-- Navigation bar with classes for styling -->
                <nav class="navbar bg-secondary navbar-dark">
                    <!-- Brand link with a heading and icon -->
                    <a href="#" class="navbar-brand mx-4 mb-3">
                        <h5 class="text-primary"><i class="fa fa-user-edit me-2"></i>Galeria Bernardino</h5>
                    </a>
                    <!-- Div for user information with classes for alignment -->
                    <div class="d-flex align-items-center ms-4 mb-4">
                        <!-- Positioned image with rounded circle and status dot -->
                        <div class="position-relative">
                            <img class="rounded-circle" src="img/user.jpg" alt="" style="width: 40px; height: 40px;">
                            <div class="bg-success rounded-circle border border-2 border-white position-absolute end-0 bottom-0 p-1"></div>
                        </div>
                        <!-- User details with a heading and role -->
                        <div class="ms-3">
                            <h6 class="mb-0">Carlos</h6>
                            <span>Admin</span>
                        </div>
                    </div>
                    <!-- Navigation links with classes for styling -->
                    <div class="navbar-nav w-100">
                        <a href="tabela_agendamento.html" class="nav-item nav-link "><i class="fa fa-tachometer-alt me-2"></i>Agendamento</a>
                        <a href="tabela_cadastro.html" class="nav-item nav-link active"><i class="fa fa-tachometer-alt me-2"></i>Cadastro</a>
                        <a href="recebidos.html" class="nav-item nav-link"><i class="fa fa-laptop me-2"></i>Recebidos</a>
                        <a href="lista.html" class="nav-item nav-link"><i class="fa fa-table me-2"></i>A Fazer</a>
                    </div>
                </nav>
            </div>
            <!-- Sidebar End -->

            <!-- Content Start -->
            <!-- Div for the main content with a class for styling -->
            <div class="content">
                <!-- Navbar Start -->
                <!-- Navigation bar with classes for styling and positioning -->
                <nav class="navbar navbar-expand bg-secondary navbar-dark sticky-top px-4 py-0">
                    <!-- Brand link with an icon for smaller screens -->
                    <a href="index.html" class="navbar-brand d-flex d-lg-none me-4">
                        <h2 class="text-primary mb-0"><i class="fa fa-user-edit"></i></h2>
                    </a>
                    <!-- Button for toggling the sidebar with an icon -->
                    <a href="#" class="sidebar-toggler flex-shrink-0">
                        <i class="fa fa-bars"></i>
                    </a>
                    <!-- Div for user information with dropdown menu -->
                    <div class="navbar-nav align-items-center ms-auto">
                        <div class="nav-item dropdown">
                            <!-- Dropdown link with user image and name -->
                            <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
                                <img class="rounded-circle me-lg-2" src="img/user.jpg" alt="" style="width: 40px; height: 40px;">
                                <span class="d-none d-lg-inline-flex">Carlos</span>
                            </a>
                            <!-- Dropdown menu with a link for logging out -->
                            <div class="dropdown-menu dropdown-menu-end bg-secondary border-0 rounded-0 rounded-bottom m-0">
                                <a href="index.html" class="dropdown-item">Sair</a>
                            </div>
                        </div>
                    </div>
                </nav>
                <!-- Navbar End -->

                <!-- Recent Sales Start -->
                <!-- Div for recent sales with classes for styling -->
                <div class="container-fluid pt-4 px-4">
                    <!-- Div for the search bar and buttons with background and padding -->
                    <div class="bg-secondary text-center rounded p-4">
                        <!-- Container for inner elements with a row and margin -->
                        <div class="container">
                            <!-- Row for search bar and buttons with margin top -->
                            <div class="row mt-3">
                                <!-- Column for search bar with margin bottom -->
                                <div class="col-8">
                                    <div class="mb-3">
                                        <label for="txtPesquisar" class="form-label"></label>
                                        <input type="text" class="form-control" id="txtPesquisar" placeholder="Digite um texto">
                                    </div>
                                </div>
                                <!-- Column for buttons with inline styling for margin top -->
                                <div class="col-4" style="margin-top: 30px;">
                                    <!-- Button for triggering the "pesquisar()" function with a search icon -->
                                    <button type="button" class="btn btn-warning" onclick="pesquisar()"><i class="bi bi-search"></i> Pesquisar</button>
                                    <!-- Button for triggering a modal with a plus icon -->
                                    <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#cadastroCliente"><i class="bi bi-plus-circle-fill"></i> Novo</button>
                                </div>
                            </div>
                            <!-- Row for the table with margin top -->
                            <div class="row">
                                <!-- Table with striped rows and headers for data display -->
                                <table class="table table-striped">
                                    <thead>
                                      <tr>
                                        <!-- Table headers for different data columns -->
                                        <th scope="col">Id</th>
                                        <th scope="col">Nome</th>
                                        <th scope="col">E-mail</th>
                                        <th scope="col">Senha</th>
                                      </tr>
                                    </thead>
                                    <!-- Table body with id "tbody" for dynamic content insertion -->
                                    <tbody id="tbody">

                                    </tbody>
                                  </table>
                            </div>
                        </div>
                        <!-- Modal -->
                        <!-- Form for client registration with a modal and inline styling for padding and background color -->
                        <form method="post" onsubmit="submitEventForm(event)">
                            <div class="modal fade" id="cadastroCliente" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                <div class="modal-dialog">
                                <div class="bg-secondary modal-content">
                                    <div class="modal-header">
                                    <!-- Modal title with a heading and a close button -->
                                    <h1 class="modal-title fs-5" id="exampleModalLabel">Cadastro de Cliente</h1>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <!-- Form inputs for client details with labels and placeholders -->
                                        <div class="mb-3">
                                            <label for="txtNome" class="form-label">Nome</label>
                                            <input type="text" class="form-control" id="txtNome" placeholder="Digite o seu nome">
                                        </div>
                                        <div class="mb-3">
                                            <label for="txtEmail" class="form-label">Email</label>
                                            <input type="email" class="form-control" id="txtEmail" placeholder="Digite o seu email">
                                      </div>
                                      <div class="mb-3">
                                        <label for="txtSenha" class="form-label">Senha</label>
                                          <input type="text" class="form-control" id="txtSenha" placeholder="Digite a sua senha">
                                      </div>
                            
                                      <!-- Checkbox (empty) -->
                                      <div class="checkbox mb-3">
                            
                                      </div>
                            
                                      <!-- Button for submitting the form data with inline styling for width -->
                                      <button class="w-100 btn btn-lg btn-primary" type="post" onclick="salvar()">Cadastrar</button>
                                     
                                    </div>  
                                </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <!-- Recent Sales End -->
                </div>
                <!-- Content End -->
            </div>
        </div>
    </div>
    <script>
        // Function to be executed when the window loads
        window.onload = function() {
            // Retrieving stored email and password from sessionStorage
            var storedEmail = sessionStorage.getItem('email');
            var storedPassword = sessionStorage.getItem('password');
    
            // Checking if the stored email and password match the predefined values
            if (storedEmail === "admin@admin" && storedPassword === "super@@123") {
                // Displaying the 'tela' element if the credentials match
                document.getElementById("tela").style.display = "block";
            } else {
                // Prompting the user for email and password if the credentials don't match
                var email = prompt("Por favor, insira o Email:");
                if (email === "admin@admin") {
                    var senha = prompt("Por favor, insira a senha:");
                    if (senha === "super@@123") {
                        // Storing the email and password in sessionStorage
                        sessionStorage.setItem('email', email);
                        sessionStorage.setItem('password', senha);
                        // Displaying the 'tela' element if the credentials match
                        document.getElementById("tela").style.display = "block";
                    } else {
                        // Alerting the user if access is denied and taking them back to the previous page
                        alert("Acesso negado. Você não tem permissão para visualizar esta página.");
                        window.history.back(); // This will take the browser back to the previous page.
                    }
                } else {
                    // Alerting the user if access is denied and taking them back to the previous page
                    alert("Acesso negado. Você não tem permissão para visualizar esta página.");
                    window.history.back(); // This will take the browser back to the previous page.
                }
            }
    
            // Calling the function 'listarClientes()' to display the table correctly
            listarClientes();
        };
    </script>
    
    
    <!-- Additional Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>
    
    <script>
        // Function to prevent the default form submission event
        function submitEventForm(event){
            event.preventDefault();
        }
    
        // Array to store clients' data
        let clientes = [];
        // URL for the API endpoint
        const url = "https://653fd58445bedb25bfc15109.mockapi.io/funcionario";
    
        // Function to save client data
        function salvar() {
            // Retrieving input values for name, email, and password
            let nome = document.querySelector('#txtNome').value;
            let email = document.querySelector('#txtEmail').value;
            let senha = document.querySelector('#txtSenha').value;
    
            // Retrieving the button element for saving or updating clients
            let botaoSalvar = document.querySelector("button.btn.btn-primary");
    
            // Condition for saving a new client
            if (botaoSalvar.textContent === "Cadastrar") {
                let json = { nome, email, senha };
    
                // Sending a POST request to the server to add a new client
                fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(json)
                }).then(response => response.json())
                .then(data => {
                    alert('Inserido com sucesso.');
                    listarClientes();
                });
            } else if (botaoSalvar.textContent === "Atualizar") { // Condition for updating an existing client
                let id = parseInt(botaoSalvar.dataset.clienteId);
                alterarCliente(id, nome, email, senha);
            }
        }
    
        // Function to list all the clients
        function listarClientes() {
            fetch(url).then(resposta => resposta.json())
                .then(valor => {
                    clientes = valor;
                    carregarTabela(clientes);
                })
        }
    
        // Function to load the client table
        function carregarTabela(clientes) {
            // Getting the table body element
            let tbody = document.querySelector("tbody");
            tbody.textContent = "";
            clientes.forEach(cli => {
                // Creating table elements for each client
                let tr = document.createElement('tr');
                let thId = document.createElement('th');
                let tdNome = document.createElement('td');
                let tdEmail = document.createElement('td');
                let tdSenha = document.createElement('td');
    
                thId.textContent = cli.id;
                tdNome.textContent = cli.nome;
                tdEmail.textContent = cli.email;
                tdSenha.innerHTML = "*".repeat(cli.senha.length); // Displaying the password as asterisks
    
                // Creating buttons for editing and deleting a client
                let tdAlterar = document.createElement('td');
                let tdExcluir = document.createElement('td');
    
                tdAlterar.innerHTML = '<button type="button" class="btn btn-info" onclick="buscarCliente(' + cli.id + ')"><i class="bi bi-pencil-square"></i> Alterar</button>';
    
                tdExcluir.innerHTML = '<button type="button" class="btn btn-danger" onclick="excluirCliente(' + cli.id + ')"><i class="bi bi-trash"></i> Excluir</button>';
    
                tr.appendChild(thId);
                tr.appendChild(tdNome);
                tr.appendChild(tdEmail);
                tr.appendChild(tdSenha);
                tr.appendChild(tdAlterar);
                tr.appendChild(tdExcluir);
                tbody.appendChild(tr);
            });
        }
    
        // Function to search for a client
        function pesquisar() {
            let textoPesquisa = document.querySelector('#txtPesquisar').value;
            let clientesFiltrado = clientes.filter(cli => cli.nome.includes(textoPesquisa) || cli.email.includes(textoPesquisa))
            carregarTabela(clientesFiltrado);
        }
    
        // Function to delete a client
        function excluirCliente(id) {
            if (confirm('Tem certeza que deseja excluir este cliente?')) {
                fetch(url + '/' + id, {
                    method: 'DELETE'
                }).then(response => {
                    if (response.status === 200) {
                        alert('Cliente excluído com sucesso.');
                        listarClientes();
                    } else {
                        alert('Erro ao excluir o cliente.');
                    }
                });
            }
        }
    
        // Function to find a specific client for editing
        function buscarCliente(id) {
            let cliente = clientes.find(cli => cli.id == id);
            if (cliente) {
                document.querySelector('#txtNome').value = cliente.nome;
                document.querySelector('#txtEmail').value = cliente.email;
                document.querySelector('#txtSenha').value = cliente.senha;
                let botaoSalvar = document.querySelector("button.btn.btn-primary");
                botaoSalvar.textContent = "Atualizar";
                botaoSalvar.dataset.clienteId = cliente.id;
                botaoSalvar.onclick = function () {
                    salvar();
                };
                let meuModal = new bootstrap.Modal(document.getElementById('cadastroCliente'));
                meuModal.show();
            }
        }
    
        // Function to update a client's details
        function alterarCliente(id, nome, email, senha) {
            let json = { id, nome, email, senha };
            fetch(url + '/' + id, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(json)
            }).then(response => {
                if (response.ok) {
                    alert('Cliente alterado com sucesso.');
                    listarClientes();
                    let botaoSalvar = document.querySelector("button.btn.btn-primary");
                    botaoSalvar.textContent = "Salvar";
                    botaoSalvar.onclick = function () {
                        salvar();
                    };
                } else {
                    alert('Erro ao alterar o cliente.');
                }
            }).catch(error => {
                console.error('Erro na requisição de alteração: ', error);
            });
        }
    
        // Hiding the modal when the page loads
        let meuModal = new bootstrap.Modal(document.getElementById('cadastroCliente'));
        meuModal.hide();
    
        // Event listener for the modal close event
        document.getElementById('cadastroCliente').addEventListener('hidden.bs.modal', function () {
            limparFormularioNovo();
        });
    
        // Function to clear the form inputs
        function limparFormularioNovo() {
            document.querySelector('#txtNome').value = '';
            document.querySelector('#txtEmail').value = '';
            document.querySelector('#txtSenha').value = '';
        }
    </script>
    
    <!-- Including necessary libraries and plugins -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="lib/chart/chart.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="lib/tempusdominus/js/moment.min.js"></script>
    <script src="lib/tempusdominus/js/moment-timezone.min.js"></script>
    <script src="lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>
    
    <!-- Main JavaScript file -->
    <script src="js/main.js"></script>
    </body>
    
    </html>
    